<script>
    $( function() {
        function log( message ) {
            $( "<div>" ).text( message ).prependTo( "#log" );
            $( "#log" ).scrollTop( 0 );
        }
        $( "#winter_jobs_RoadSectionSearch" ).autocomplete({
            source: "{{ path('search/road') }}",
            minLength: 2,
            delay: 500,
            select: function( event, ui ) {
                $('#winter_jobs_RoadSection').val(ui.item.section_id),
                    $('#winter_jobs_RoadName').val(ui.item.road_name),
                    $('#winter_jobs_SectionBegin').val(ui.item.section_begin),
                    $('#winter_jobs_SectionEnd').val(ui.item.section_end)
            },
        });
        $( ".js-datepicker" ).datepicker();
    });

    $(document).ready(function () {
        document.getElementById('winter_jobs_Salt').style.display = 'none'
        document.getElementById('winter_jobs_Sand').style.display = 'none'
        document.getElementById('winter_jobs_Mix').style.display = 'none'
        document.getElementById('winter_jobs_Solution').style.display = 'none'
        if (document.getElementById('winter_jobs_SaltChecked').checked == true){
            document.getElementById('winter_jobs_Salt').style.display = 'inline'
        }
        if (document.getElementById('winter_jobs_SandChecked').checked == true){
            document.getElementById('winter_jobs_Sand').style.display = 'inline'
        }
        if (document.getElementById('winter_jobs_MixChecked').checked == true){
            document.getElementById('winter_jobs_Mix').style.display = 'inline'
        }
        if (document.getElementById('winter_jobs_SolutionChecked').checked == true){
            document.getElementById('winter_jobs_Solution').style.display = 'inline'
        }

        $('#winter_jobs_SaltChecked').click(function () {
            if (this.checked) {
                document.getElementById('winter_jobs_Salt').style.display = 'inline'
                //$('#salt').slideDown(500)
            }
            else {
                document.getElementById('winter_jobs_Salt').style.display = 'none'
                //$('#salt').slideUp(200)
            }
        })
        $('#winter_jobs_SandChecked').click(function () {
            if (this.checked) {
                document.getElementById('winter_jobs_Sand').style.display = 'inline'
                //$('#salt').slideDown(500)
            }
            else {
                document.getElementById('winter_jobs_Sand').style.display = 'none'
                //$('#salt').slideUp(200)
            }
        })
        $('#winter_jobs_MixChecked').click(function () {
            if (this.checked) {
                document.getElementById('winter_jobs_Mix').style.display = 'inline'
                //$('#salt').slideDown(500)
            }
            else {
                document.getElementById('winter_jobs_Mix').style.display = 'none'
                //$('#salt').slideUp(200)
            }
        })
        $('#winter_jobs_SolutionChecked').click(function () {
            if (this.checked) {
                document.getElementById('winter_jobs_Solution').style.display = 'inline'
                //$('#salt').slideDown(500)
            }
            else {
                document.getElementById('winter_jobs_Solution').style.display = 'none'
                //$('#salt').slideUp(200)
            }
        })
    })
</script>

<script>
    // this variable is the list in the dom, it's initiliazed when the document is ready
    var $collectionHolder;
    // the link which we click on to add new items
    var $addNewItem = $('<a href="#" class="btn btn-info">Add new item</a>');
    // when the page is loaded and ready
    $(document).ready(function () {
        // get the collectionHolder, initilize the var by getting the list;
        $collectionHolder = $('#road_section_list');
        // append the add new item link to the collectionHolder
        $collectionHolder.append($addNewItem);
        // add an index property to the collectionHolder which helps track the count of forms we have in the list
        $collectionHolder.data('index', $collectionHolder.find('.panel').length)
        // finds all the panels in the list and foreach one of them we add a remove button to it
        // add remove button to existing items
        $collectionHolder.find('.panel').each(function () {
            // $(this) means the current panel that we are at
            // which means we pass the panel to the addRemoveButton function
            // inside the function we create a footer and remove link and append them to the panel
            // more informations in the function inside
            addRemoveButton($(this));
        });
        // handle the click event for addNewItem
        $addNewItem.click(function (e) {
            // preventDefault() is your  homework if you don't know what it is
            // also look up preventPropagation both are usefull
            e.preventDefault();
            // create a new form and append it to the collectionHolder
            // and by form we mean a new panel which contains the form
            addNewForm();
        })
    });
    /*
     * creates a new form and appends it to the collectionHolder
     */
    function addNewForm() {
        // getting the prototype
        // the prototype is the form itself, plain html
        var prototype = $collectionHolder.data('prototype');
        // get the index
        // this is the index we set when the document was ready, look above for more info
        var index = $collectionHolder.data('index');
        // create the form
        var newForm = prototype;
        // replace the __name__ string in the html using a regular expression with the index value
        newForm = newForm.replace(/__name__/g, index);
        // incrementing the index data and setting it again to the collectionHolder
        $collectionHolder.data('index', index+1);
        // create the panel
        // this is the panel that will be appending to the collectionHolder
        var $panel = $('' +
            '<div class="panel col-3">' +
                '<div class="panel-heading text-center">' +
                    '<strong>New Road</strong>' +
                '</div>' +
            '</div>');
        // create the panel-body and append the form to it
        var $panelBody = $('<div class="panel-body"></div>').append(newForm);
        // append the body to the panel
        $panel.append($panelBody);
        // append the removebutton to the new panel
        addRemoveButton($panel);
        // append the panel to the addNewItem
        // we are doing it this way to that the link is always at the bottom of the collectionHolder
        $addNewItem.before($panel);
    }

    /**
     * adds a remove button to the panel that is passed in the parameter
     * @param $panel
     */
    function addRemoveButton ($panel) {
        // create remove button
        var $removeButton = $('<a href="#" class="btn btn-danger col-12">Remove</a>');
        // appending the removebutton to the panel footer
        var $panelFooter = $('<div class="panel-footer"></div>').append($removeButton);
        // handle the click event of the remove button
        $removeButton.click(function (e) {
            e.preventDefault();
            // gets the parent of the button that we clicked on "the panel" and animates it
            // after the animation is done the element (the panel) is removed from the html
            $(e.target).parents('.panel').fadeOut(150, function () {
                $(this).remove();
            })
        });
        // append the footer to the panel
        $panel.append($panelFooter);

    }

</script>

{{ form_start(form) }}
<div class="row" id="road_section_list" data-prototype="{{ form_widget(form.RoadSections.vars.prototype)|e('html_attr') }}">
    {% for row in form.RoadSections %}
        <div class="panel col-3">
            <div class="panel-heading text-center">
                <strong>Road</strong>
            </div>
            <div class="panel-body">
                {{ form_row(row) }}
            </div>
        </div>
    {% endfor %}
</div>
</div>

<div class="form form-inline">
    {{ form_row(form.TimeFrom) }} &nbsp;&nbsp;
    {{ form_row(form.TimeTo) }}
</div>
<hr>
{#
<div class="row">
    <div id="salt" class="col-sm">
        {{ form_row(form.RoadSectionSearch) }}
        {{ form_row(form.RoadSection) }}
    </div>
    <div id="salt" class="col-sm">
        {{ form_row(form.SectionBegin) }}
    </div>
    <div id="salt" class="col-sm">
        {{ form_row(form.SectionEnd) }}
    </div>
    <div id="salt" class="col-sm">
        {{ form_row(form.maintenanceLevel) }}
    </div>
</div>
#}
<hr>
<div class="row">
    <div id="salt" class="col-sm">
        {{ form_row(form.Mechanism) }}
    </div>
    <div id="salt" class="col-sm">
        {{ form_row(form.job) }}
    </div>
</div>
<hr>
<div class="form form-inline">
    {{ form_row(form.SaltChecked) }}
    {{ form_row(form.SandChecked) }}
    {{ form_row(form.MixChecked) }}
    {{ form_row(form.SolutionChecked) }}
</div>
<hr>
<div class="row">
    <div id="salt" class="col-sm">
        {{ form_row(form.Salt) }}
    </div>
    <div id="sand" class="col-sm">
        {{ form_row(form.Sand) }}
    </div>
    <div id="mix" class="col-sm">{{ form_row(form.Mix) }}
    </div>
    <div id="solution" class="col-sm">
        {{ form_row(form.Solution) }}
    </div>
</div>

<div class="form form-inline">
    {{ form_row(form.save) }}
</div>
<hr>

{{ form_end(form) }}